include ':app'

def properties = { file ->
  if (file.exists()) {
    def p = new Properties()
    file.withReader("UTF-8") { reader -> p.load(reader) }
    return p
  }
  return null
}

def flutterSdkPath = properties(file("$rootDir/local.properties"))?.getProperty("flutter.sdk")
assert flutterSdkPath != null, "flutter.sdk not set in local.properties"

apply from: "$flutterSdkPath/packages/flutter_tools/gradle/app_plugin_loader.gradle"

def flutterProjectRoot = rootProject.projectDir.parentFile.toPath()
properties(file("$flutterProjectRoot/.flutter-plugins"))?.each { name, path ->
  def pluginDirectory = flutterProjectRoot.resolve(path).resolve('android').toFile()
  include ":$name"
  project(":$name").projectDir = pluginDirectory
}
